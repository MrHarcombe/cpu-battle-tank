<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CPU BattleTanks</title>
<link rel="stylesheet" type="text/css" href="lib/jqmobile/jquery.mobile-1.4.5.min.css">
<link rel="stylesheet" type="text/css" href="styles/main.css">
<script src="lib/jqmobile/jquery-1.11.2.min.js"></script>
<script src="lib/jqmobile/jquery.mobile-1.4.5.min.js"></script>
<script src="lib/battletanks.js"></script>
<script src="lib/ace/ace.js"></script>
<script src="lib/ace/mode-lmc.js"></script>
</head>

<body>

<div data-role="page">
	
	<div data-role="header"><h1>Battle Tanks by P. Dring</h1>
    <a href="#settings" data-icon="gear">Settings</a>
    <a href="#objectives" data-icon="check">Objectives</a>
    <span id="status_bar"></span>
    </div>
    
	<div role="main" class="ui-content battleground">
	    <img src="media/logo small.png" class="logo"/>
        <img src="media/controller.png" class="controller" />                
    	<div id="grid"></div>
    	<div id="tanks"></div>
    </div>
    
    
    <div data-role="panel" id="objectives" data-display="overlay" data-position="right">
    <h1>Objectives</h1>
    </div>
    <div data-role="panel" id="help" data-display="overlay" data-position="right">
    	<h1>Help</h1>
        <p>Tanks are controlled with <a href="http://en.wikipedia.org/wiki/Little_man_computer">Little Man Computer</a> processors. These processors are programmed with a limited number of low level instructions.</p>
        <h2>Instructions</h2>
        <table><tr><th>Instruction</th><th>Memory value</th><th>Description</th></tr>
        <tr><td>ADD</td><td>1xx</td><td class="ins_description">Add the value stored at memory address xx to the value in the accumulator register</td></tr>
        <tr><td>SUB</td><td>2xx</td><td class="ins_description">Subtract the value stored at memory address xx from the value in the accumulator register</td></tr>
        <tr><td>STA</td><td>3xx</td><td class="ins_description">Store the value from the accumulator register to the memory address xx</td></tr>
        <tr><td>LDA</td><td>5xx</td><td class="ins_description">Load the value from the memory address xx into the accumulator register</td></tr>
        <tr><td>BRA</td><td>6xx</td><td class="ins_description">Branch to xx (store xx in the program counter register so that the program will jump to xx on the next instruction cycle)</td></tr>
        <tr><td>BRZ</td><td>7xx</td><td class="ins_description">Branch if the accumulator register stores the value zero, otherwise carry on as normal</td></tr>
        <tr><td>BRP</td><td>8xx</td><td class="ins_description">Branch if the accumulator register stores zero or a positive number</td></tr>
        <tr><td>INP</td><td>9x1</td><td class="ins_description">Read a value from the input device x and store it in the accumulator register</td></tr>
        <tr><td>OUT</td><td>9x2</td><td class="ins_description">Send the contents of the accumulator register to the output device x</td></tr>
        <tr><td>HLT</td><td>000</td><td class="ins_description">Halt / Stop the processor</td></tr>
        <tr><td>DAT</td><td>xxx</td><td class="ins_description">Stores xxx in memory to be used as data</td></tr>
        </table>
    </div>
    <div data-role="panel" id="settings">
    	<h1>Settings</h1>
        <label for="show-name"><a href="#pop_show_name" data-rel="popup" data-role="button" data-inline="true" data-iconpos="notext" data-icon="info">Help</a>Tank names:</label>
        <select name="show-name" class="ctl_setting" id="setting_tank_show_name" data-role="slider" data-mini="true">	
            <option value="hide">Hide</option>
            <option value="show">Show</option>
        </select>
        <div data-role="popup" data-history="false" id="pop_show_name">Show or hide the name of each tank on the battle grid</div>
        
        <label for="show-name"><a href="#pop_show_fuel" data-rel="popup" data-role="button" data-inline="true" data-iconpos="notext" data-icon="info">Help</a>Fuel details:</label>
        <select name="show-fuel" class="ctl_setting" id="setting_tank_show_fuel" data-role="slider" data-mini="true">
            <option value="hide">Hide</option>
            <option value="show">Show</option>
        </select>
        <div data-role="popup" data-history="false" id="pop_show_fuel">Show or hide the amount of fuel underneath each tank on the battle grid</div>
        
        <label for="show-name"><a href="#pop_show_ammo" data-rel="popup" data-role="button" data-inline="true" data-iconpos="notext" data-icon="info">Help</a>Ammo details:</label>
        <select name="show-ammo" class="ctl_setting" id="setting_tank_show_ammo" data-role="slider" data-mini="true">
            <option value="hide">Hide</option>
            <option value="show">Show</option>
        </select>
        <div data-role="popup" data-history="false" id="pop_show_ammo">Show or hide the ammount of ammo remaining under each tank on the battle grid</div>
        
        <label for="show-commands"><a href="#pop_show_commands" data-rel="popup" data-role="button" data-inline="true" data-iconpos="notext" data-icon="info">Help</a>Tank command queue:</label>
        <select name="show-commands" class="ctl_setting" id="setting_tank_show_commands" data-role="slider" data-mini="true">
            <option value="hide">Hide</option>
            <option value="show">Show</option>
        </select>
        <div data-role="popup" data-history="false" id="pop_show_commands">Show or hide the list of all commands for each tank</div>
        
        <label for="show-grid"><a href="#pop_show_grid" data-rel="popup" data-role="button" data-inline="true" data-iconpos="notext" data-icon="info">Help</a>Grid lines:</label>
        <select name="show-grid" class="ctl_setting" id="setting_grid_show_borders" data-role="slider" data-mini="true">
            <option value="hide">Hide</option>
            <option value="show">Show</option>
        </select>
        <div data-role="popup" data-history="false" id="pop_show_grid">Show or hide the grid lines</div>
    </div>
    <div id="dlg" data-role="popup" data-history="false" data-transition="fade"></div>
	<div data-role="footer"></div>
</div>

<script> 
var bt = new BattleTank();

var onControllerClick = function(e) {
	function inBox(x, y, left, top, width, height) {
		return((x > left) && (x < left + width) && (y > top) && (y < top + height))? true: false;
	}
	var x = e.offsetX;
	var y = e.offsetY;
	var t1 = bt.currentTank;
	// move tank
	if(inBox(x, y, 70, 17, 64, 64))  
		t1.addCommand(t1.CMD_MOVE_FORWARDS);
	if(inBox(x, y, 70, 112, 64, 64))  
		t1.addCommand(t1.CMD_MOVE_BACKWARDS);
	if(inBox(x, y, 120, 64, 64, 64))  
		t1.addCommand(t1.CMD_TURN_CLOCKWISE);
	if(inBox(x, y, 20, 64, 64, 64))  
		t1.addCommand(t1.CMD_TURN_ANTICLOCKWISE);
		
	// aim tank
	if(inBox(x, y, 233, 37, 64, 64))  
		t1.addCommand(t1.CMD_AIM_ANTICLOCKWISE);
	if(inBox(x, y, 310, 37, 64, 64))  
		t1.addCommand(t1.CMD_AIM_CLOCKWISE);
	if(inBox(x, y, 274, 86, 64, 64))
		t1.addCommand(t1.CMD_FIRE);
	
}



$(function(){
	
	bt.grid.init();
		
	var l1 = bt.addLevel({tank: {x:1, y:1, name: "You", color:"rgba(0, 255,0,0.8)"}, title: "Level 1", description:"Follow the checkpoints and destroy the tank", 
		tasks:[
		[0, 0, bt.ITEM_TYPE_CHECKPOINT, bt.ACTION_COLLECT],
		[0, 4, bt.ITEM_TYPE_CHECKPOINT, bt.ACTION_COLLECT],
		[3, 4, bt.ITEM_TYPE_FUEL, bt.ACTION_COLLECT],
		[3, 3, bt.ITEM_TYPE_WATER, bt.ACTION_STATIC],
		[4, 3, bt.ITEM_TYPE_WATER, bt.ACTION_STATIC],
		[5, 3, bt.ITEM_TYPE_WATER, bt.ACTION_STATIC],
		[1, 3, bt.ITEM_TYPE_MINE, bt.ACTION_DESTROY],
		[5, 5, bt.ITEM_TYPE_STRAW, bt.ACTION_DESTROY],
		[5, 4, bt.ITEM_TYPE_TANK, bt.ACTION_DESTROY, {name:"German", color:"rgba(255,0,0,0,0.8)", commands:""}]
		]});
	bt.grid.loadLevel(l1);
	
	
	$(".controller").click(onControllerClick);
	
	// set default settings values
	$('#setting_tank_show_name').val(bt.settings.showTankNames?"show":"hide");
	$('#setting_tank_show_fuel').val(bt.settings.showFuelDetails?"show":"hide");
	$('#setting_tank_show_ammo').val(bt.settings.showAmmoDetails?"show":"hide");
	$('#setting_tank_show_commands').val(bt.settings.showCommandQueue?"show":"hide");
	$('#setting_grid_show_borders').val(bt.settings.showGrid?"show":"hide");
	$('.ctl_setting').slider('refresh');
	bt.onSettingChange();
	
	// add settings change callback
	$('.ctl_setting').on("change", function(event, ui) {
		var id = event.target.id;
		var val=$("#" + id).val() == "show"?true:false;
		switch(id) {
			case 'setting_tank_show_name': 
				bt.settings.showTankNames = val;
				break;
			case 'setting_tank_show_fuel':
				bt.settings.showFuelDetails = val;
				break;
			case 'setting_tank_show_ammo':
				bt.settings.showAmmoDetails = val;
				break;
			case 'setting_tank_show_commands':
				bt.settings.showCommandQueue = val;
				break;
			case 'setting_grid_show_borders':
				bt.settings.showGrid = val;
		}
		bt.onSettingChange(id);
	});
});
</script>
</body>

</html>

